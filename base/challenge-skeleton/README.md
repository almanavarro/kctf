# Quickstart guide to writing a challenge:

* put the challenge binary in challenge/image/ and update the Dockerfile inside
* by default /home/user/chal will be run. The command line can be changed in challenge/dynamic/nsjail.cfg.
* Try the challenge locally with `make -j test-docker`
* If you have a cluster ready, try it remotely with `make -j start && make port-forward`

## healthcheck

* the healthcheck needs to run a webserver on port 8080 that responds to /healthz requests
 * 200 if the challenge is healthy, otherwise an error (e.g. 400)
* the base image comes preloaded with pwntools.
* if your exploit is written in python, just drop it in healthcheck/exploit/doit.py
* Note: for defense in depth, the exploit is encrypted before being added to the docker image

# Directory layout:

## /

* chal.conf: configure if the challenge should be deployed to the cluster if it's publicly accessible and if it has a healthcheck
* Makefile: anything that needs to be run before deploying a challenge
* challenge: the files for the challenge container
* healthcheck: the files for the healthcheck container (optional)
* advanced: the kubernetes config used to deploy the challenge. E.g. add a tmpfs here or change the port.
* .gen: a directory for files generated by make.

## /challenge

* image/: Dockerfile and files of the challenge image. Note that for defense in depth, you shouldn't put secrets in here.
* dynamic: files to be added to the challenge at runtime. Secrets are ok, but note that there's a size limit. Supports live updates without a challenge restart.
* dynamic/kustomization.yaml: a kubernetes patch file. You only have to touch it if you add a new file to this directory.
* dynamic/flag: the flag (duh)
* dynamic/nsjail.cfg: the configuration for the nsjail sandbox. Configure here limits and what you want to expose to the challenge chroot.
* dynamic/pow: difficulty of the proof-of-work. 0 means disabled

## /healthcheck

* /: the whole directory is optional. If you're not going to implement a healthcheck, feel free to delete this.
* image/: Dockerfile and files of the healthcheck
* exploit/: the exploit code to check if the challenge is healthy. This directory will be encrypted for defense in depth.
* dynamic/: same as challenge/dyanmic, see above.
